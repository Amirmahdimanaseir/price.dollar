import requests
from bs4 import BeautifulSoup
import smtplib
from email.mime.text import MIMEText
from email.mime.multipart import MIMEMultipart

# === ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø§ÛŒÙ…ÛŒÙ„ ===
EMAIL_SENDER = "your@gmail.com"  # Ø§ÛŒÙ…ÛŒÙ„ Ø§Ø±Ø³Ø§Ù„â€ŒÚ©Ù†Ù†Ø¯Ù‡
EMAIL_PASSWORD = "your passworl"  # Ø±Ù…Ø² Ø¹Ø¨ÙˆØ± (ÛŒØ§ App Password Ø¨Ø±Ø§ÛŒ Ø¬ÛŒÙ…ÛŒÙ„)
EMAIL_RECEIVER = "your@example.com"  # Ø§ÛŒÙ…ÛŒÙ„ Ú¯ÛŒØ±Ù†Ø¯Ù‡

# === Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± Ø§Ø² tgju.org ===
def get_dollar_price():
    url = "https://www.tgju.org/currency"
    try:
        response = requests.get(url)
        soup = BeautifulSoup(response.text, 'html.parser')
        
        # Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± Ø¯Ø± ØªÚ¯ Ù…Ù†Ø§Ø³Ø¨
        price_section = soup.find('span', {'class': 'price-value'})  # Ø¨Ù‡â€ŒØ±ÙˆØ²â€ŒØ±Ø³Ø§Ù†ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ Ø³Ø§Ø®ØªØ§Ø± Ø³Ø§ÛŒØª
        if price_section:
            dollar_price = price_section.text.strip()
            return dollar_price
        else:
            print("âŒ Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯.")
            return None
    except Exception as e:
        print(f"âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª: {e}")
        return None

# === Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„ ===
def send_email(price):
    try:
        subject = "ğŸ”¹ Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø± Ø¯Ø± Ø¨Ø§Ø²Ø§Ø± Ø¢Ø²Ø§Ø¯"
        body = f"ğŸ’° Ù‚ÛŒÙ…Øª Ù„Ø­Ø¸Ù‡â€ŒØ§ÛŒ Ø¯Ù„Ø§Ø±: {price} ØªÙˆÙ…Ø§Ù†\nâ° Ø§ÛŒÙ† Ù¾ÛŒØ§Ù… Ù‡Ø± Û± Ø³Ø§Ø¹Øª ÛŒÚ©â€ŒØ¨Ø§Ø± Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯."

        msg = MIMEMultipart()
        msg["From"] = EMAIL_SENDER
        msg["To"] = EMAIL_RECEIVER
        msg["Subject"] = subject
        msg.attach(MIMEText(body, "plain"))

        server = smtplib.SMTP("smtp.gmail.com", 587)
        server.starttls()
        server.login(EMAIL_SENDER, EMAIL_PASSWORD)
        server.sendmail(EMAIL_SENDER, EMAIL_RECEIVER, msg.as_string())
        server.quit()

        print("âœ… Ø§ÛŒÙ…ÛŒÙ„ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯.")
    except Exception as e:
        print("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ Ø§ÛŒÙ…ÛŒÙ„:", e)

# === Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ Ù‡Ø± Û± Ø³Ø§Ø¹Øª ===
def job():
    price = get_dollar_price()
    if price:
        send_email(price)
    else:
        print("âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù‚ÛŒÙ…Øª Ø¯Ù„Ø§Ø±.")

# === Ø§Ø¬Ø±Ø§ÛŒ Ø¨Ø±Ù†Ø§Ù…Ù‡ ===
job()  # ØªØ³Øª Ø¨Ø±Ù†Ø§Ù…Ù‡ ÛŒÚ© Ø¨Ø§Ø±
